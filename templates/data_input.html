<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Heart Risk Calculator</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- Le styles -->
        <link href="static/css/bootstrap.min.css" rel="stylesheet">
        <style>
            body {
                padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
            }
        </style>
        <link href="static/css/bootstrap-responsive.min.css" rel="stylesheet">

        <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- Le fav and touch icons -->
        <link rel="shortcut icon" href="ico/favicon.ico">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">
    </head>

    <body>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#"><i class="icon-heart icon-white"></i>Heart Risk Calculator</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li class="active"><a href="#">Home</a></li>
                            <li><a href="static/faq.html">FAQ</a></li>
                            <li><a href="#contact">Contact</a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container">

            <div class="tabbable tabs-left"> <!-- Only required for left/right tabs -->
                <ul id="myTab" class="nav nav-tabs">
                    <li class="tablink active" id="tabIntro_link"><a href="#tabIntro" data-toggle="tab">Intro</a></li>
                    <li class="tablink disabled invisible" id="tab1_link"><a href="#tab1">Step 1</a></li>
                    <!--we add data-toggle attribute for subsequent tabs in event handler for next button
                    after verifying that all data in current tab has been entered-->
                    <li class="tablink disabled invisible" id="tab2_link"><a href="#tab2" >Step 2</a></li>
                    <li class="tablink disabled invisible" id="tab3_link"><a href="#tab3" >Step 3</a></li>
                    <li class="tablink disabled invisible" id="tab4_link"><a href="#tab4" >Step 4</a></li>
                    <li class="tablink disabled invisible" id="tabRisk_link"><a href="#tabRisk" >Your Risk</a></li>
                    <li class="tablink disabled invisible" id="tabTesting_link"><a href="#tabTesting" >Get tested</a></li>
                </ul>
                <div class="tab-content">

                    <div class="tab-pane active" id="tabIntro">
                        <div class ="well">
                    The first two steps of this risk calculator are required. The remaining steps are optional, but the more information you provide, the better our risk estimate will be. If you need more information, use the FAQ link in the bar at the top of the screen. If you are using a mobile device like a phone, click the button at the top right of the screen for more options. 
                        </div>
                        

                        <div class="control-group">
                                <div class="controls">
                                    <button id="button_to_step1" type="submit" class="btn">Get started</button>
                                </div>
                            </div><!--end of control-group for button-->
                    </div><!--end tabIntro-->

                    <div class="tab-pane" id="tab1">
                        <div class="form-horizontal">
                            <div class="control-group">
                                <label class="control-label" for="inputAge">Age</label>
                                <div class="controls">
                                    <input type="text" name="age" id="inputAge" placeholder="Please enter your age" value="40">
                                </div>
                            </div><!--end control-group for Age-->

                            <div class="control-group">
                                <label class="control-label" >Gender</label>
                                <div class="controls btn-group">
                                    <label class="radio">
                                        <input type="radio" name="gender" id="genderMale" value="M" checked>
                                        Male
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="gender" id="genderFemale" value="F">
                                        Female
                                    </label>
                                </div>
                            </div><!--end control-group for Gender-->

                            <div class="control-group">
                                <label class="control-label" for="inputHeight">Height(inches)</label>
                                <div class="controls">
                                    <input type="text" id="inputHeight" name="height" placeholder="Please enter your height" value="70">
                                </div>
                            </div><!--end control-group for Height-->

                            <div class="control-group">
                                <label class="control-label" for="inputWeight">Weight(lbs)</label>
                                <div class="controls">
                                    <input type="text" id="inputWeight" name="weight" placeholder="Please enter your weight" value="160">
                                </div>
                            </div><!--end control-group for Weight-->

                            <div class="control-group">
                                <div class="controls">
                                    <button id="button_to_prior_history" type="submit" class="btn">Next</button>
                                </div>
                            </div><!--end of control-group for button-->
                        </div><!--end form-horizontal-->
                    </div><!--end tab1-->


                    <div class="tab-pane" id="tab2">
                        <div class="form-horizontal">
                            <div class="control-group">
                                <label class="control-label"><a class='infobox' id='smoking_popover' rel="popover" data-content="Answer yes if you have smoked any cigarettes in the past month">Do you currently smoke?</a></label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="smoker" id="smoker_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="smoker" id="smoker_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for smoker-->

                            <div class="control-group">
                                <label class="control-label" ><a class='infobox' id='mi_popover' rel="popover" data-content="A heart attack is sometimes called a myocardial infarction or MI">Have you ever had a heart attack?</a></label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="mi" id="mi_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="mi" id="mi_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for heart attack-->

                            <div class="control-group">
                                <label class="control-label" >Have you ever had a stroke?</label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="stroke" id="stroke_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="stroke" id="stroke_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for stroke-->

                            <div class="control-group">
                                <label class="control-label" ><a class='infobox' id='diabetes_popover' rel="popover" data-content="Answer yes if you have diabetes mellitus type I or type II">Do you have diabetes?</a></label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="diabetes" id="diabetes_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="diabetes" id="diabetes_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for diabetes-->

                            <!--alternatively move hba1c to the next tab with other test results-->
                            <div class="control-group" id="hba1c_group">
                                <label class="control-label" for="inputHba1c">HbA1c</label>
                                <div class="controls">
                                    <input type="text" id="inputHba1c" name="hba1c" placeholder="Please enter your HbA1c(%)">
                                </div>
                            </div><!--end control-group for hba1c-->

                            <div class="control-group">
                                <div class="controls">
                                    <button id="button_to_blood_tests" type="submit" class="btn">Next</button>
                                </div>
                            </div><!--end of control-group for button-->
                        </div><!--end form-horizontal-->
                    </div><!--end tab2-->

                    <!--FIXME add tooltips for definitions of systolic, diastolic, hba1c,etc.-->
                    <div class="tab-pane" id="tab3">
                        <div class="form-horizontal">
                            <div class="control-group">
                                <label id="systolicLabel" class="control-label" for="inputSystolic"><a class='infobox'  id='systolic_popover'  rel="popover" data-content="Systolic blood pressure is the first and higher number in your blood pressure, i.e. the 120 in 120/80">Systolic</a></label>
                                <div class="controls">
                                    <input type="text" id="inputSystolic" name="systolic" placeholder="Enter systolic BP(mmHg)">
                                </div>
                            </div><!--end control-group for systolic-->
                            <div class="control-group">
                                <label id="diastolicLabel" class="control-label" for="inputDiastolic"><a class='infobox'  id='diastolic_popover'  rel="popover" data-content="Diastolic blood pressure is the second and lower number in your blood pressure, i.e. the 80 in 120/80">Diastolic</a></label>
                                <div class="controls">
                                    <input type="text" id="inputDiastolic" name="diastolic" placeholder="Enter diastolic BP(mmHg)">
                                </div>
                            </div><!--end control-group for diastolic-->

                            <div class="control-group">
                                <label class="control-label" for="inputCholesterol">Cholesterol</label>
                                <div class="controls">
                                    <input type="text" id="inputCholesterol" name="cholesterol" placeholder="Enter cholesterol">
                                </div>
                            </div><!--end control-group for cholesterol-->

                            <div class="control-group">
                                <label class="control-label" for="inputHdl">HDL</label>
                                <div class="controls">
                                    <input type="text" id="inputHdl" name="hdl" placeholder="Enter HDL">
                                </div>
                            </div><!--end control-group for hdl-->

                            <div class="control-group">
                                <label class="control-label" for="inputLdl">LDL</label>
                                <div class="controls">
                                    <input type="text" id="inputLdl" name="ldl" placeholder="Enter LDL">
                                </div>
                            </div><!--end control-group for ldl-->

                            <div class="control-group">
                                <div class="controls">
                                    <button id="button_to_optional_info" type="submit" class="btn">Next</button>
                                </div>
                            </div><!--end of control-group for button-->


                        </div><!--end form-horizontal-->
                    </div><!--end tab3-->

                    <div class="tab-pane" id="tab4">
                        <div class="form-horizontal">

                            <div class="control-group">
                                <label class="control-label" >Do you take medication to lower your cholesterol?</label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="cholesterolmeds" id="cholesterol_meds_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="cholesterolmeds" id="cholesterol_meds_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for cholesterolmeds-->

                            <div class="control-group">
                                <label class="control-label" >Do you take medication for your blood pressure?</label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="bloodpressuremeds" id="bloodpressure_meds_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="bloodpressuremeds" id="bloodpressure_meds_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for bloodpressuremeds-->

                            <div class="control-group">
                                <label class="control-label" for="inputBloodpressuremedcount">How many different blood pressure medications do you take?</label>
                                <div class="controls">
                                    <input type="text" id="inputBloodpressuremedcount" name="bloodpressuremedcount" placeholder="Enter how many">
                                </div>
                            </div><!--end control-group for bloodpressuremedcount-->


                            <div class="control-group">
                                <label class="control-label" >Do you take aspirin regularly?</label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="aspirin" id="aspirin_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="aspirin" id="aspirin_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for aspirin-->

                            <div class="control-group">
                                <label class="control-label" for="inputModerateExercise">How many hours do you spend doing moderate physical activities such as walking in a typical week?</label>
                                <div class="controls">
                                    <input type="text" id="inputModerateExercise" name="moderateexercise" placeholder="Enter how many">
                                </div>
                            </div><!--end control-group for moderateexercise-->

                            <div class="control-group">
                                <label class="control-label" for="inputVigorousExercise">How many hours do you spend doing vigorous physical activities such as running in a typical week?</label>
                                <div class="controls">
                                    <input type="text" id="inputVigorousExercise" name="vigorousexercise" placeholder="Enter how many">
                                </div>
                            </div><!--end control-group for vigorousexercise-->


                            <div class="control-group">
                                <label class="control-label" >Has an immediate relative of yours(parent,brother or sister) had a heart attack before the age of 55?</label>
                                <div class="controls">
                                    <label class="radio">
                                        <input type="radio" name="familyhistory" id="familyhistory_true" value="T" >
                                        Yes
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="familyhistory" id="familyhistory_false" value="F" checked>
                                        No
                                    </label>
                                </div>
                            </div><!--end control-group for familyhistory-->

                            <div class="control-group">
                                <div class="controls">
                                    <button id="button_submit" type="submit" class="btn">Compute my risk</button>
                                </div>
                            </div><!--end of control-group for button-->



                        </div><!--end form-horizontal-->
                    </div><!--end tab4-->


                    <div class="tab-pane" id="tabRisk">
                        <div id='riskProgress'>
                            Please wait, computing risk.
                            <img src='static/img/ajax-loader.gif' alt="Loading...">
                            </div><!--end riskProgress-->
                        <table class="table table-bordered table-condensed" id ="riskTable">
                            <tbody>
                                </tbody>
                        </table>

                        <div id="fb-root"></div>
                                                
                        <!--put picture on left, message to right-->
                        <div align="center" id="fb_referral_div">
                            Understand your risk so you can take of yourself. Get screened not just for yourself but for your loved ones. Do it for <br><div id="name"></div>
                            <img id="image"/>
                        </div>


                        <div class="control-group">
                                <div class="controls">
                                    <button id="button_to_surescripts" type="submit" class="btn">Find a screening center</button>
                                </div>
                            </div><!--end of control-group for button-->
                    </div><!--end tabRisk-->

                    <div class="tab-pane" id="tabTesting">
                        <div class="control-group">
                                <label class="control-label" for="inputMyAddress">Address:</label>
                                <div class="controls">
                                    <input type="text" id="inputMyAddress" name="myAddress" placeholder="Address or zip code">
                                </div>
                                <div class="controls">
                                    <button id="button_to_manually_geolocate" type="submit" class="btn">Use my address to find a test center</button>
                                </div>

                            </div><!--end control-group for inputMyAddress-->


                        <div class="control-group">
                            <div class="controls">
                                    <button id="button_to_html5_geolocate" type="submit" class="btn">Use current location to find test center</button>
                                </div>
                            </div>
                        <div id="testingResults">
                        Click any address below for directions.
                        <table class="table table-bordered table-condensed table-striped" id ="pharmacyTable">
                            <tbody>
                                <tr><th>Address</th><th>Distance</th></tr>
                                </tbody>
                        </table>
                    </div><!--end testingResults-->
                    </div><!--end tabTesting-->


                </div><!--end tab-content-->
            </div><!--end tabbable-->


        </div> <!-- /container -->

        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <!--move the map to its own tab-->
        <!--<div id="map" style="width: 500px; height: 400px;"></div>-->
        <div id="map"></div>

        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script src="static/js/bootstrap.min.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
                <script type="text/javascript">
            var address; 
            var map = new google.maps.Geocoder();
            var map_center_lat=0;
            var map_center_lng=0;
            var locations = [ ];
            //set map width with respect to size of containing tab
            $("#map").css('width',$('#parent').innerWidth-1);
            $("#map").css('height',$('#parent').innerHeight-1);

            $(document).ready(function(){
                    //popovers below the corresponding link fits better
                    //on small screens
                    $('#smoking_popover').popover({placement:'bottom'});
                    $('#mi_popover').popover({placement:'bottom'});
                    $('#systolic_popover').popover({placement:'bottom'});
                    $('#diastolic_popover').popover({placement:'bottom'});
                    $('#diabetes_popover').popover({placement:'bottom'});

                    //avoid having popovers that are stuck on screen
                    $(':button').click(function(e){
                        $('.infobox').popover('hide');
                        });
                    $('.tablink').click(function(e){
                        $('.infobox').popover('hide');
                        });

                    $("#button_to_step1").click(function(e){
                        $('#tab1_link').removeClass('invisible');
                        $('#myTab li:eq(1) a').tab('show');
                        $("#tab1_link").removeClass("disabled");
                        $("#tab1_link a").attr('data-toggle','tab');
                        });

                    $("#button_to_prior_history").click(function(e){
                        $('#tab2_link').removeClass('invisible');
                        $('#myTab li:eq(2) a').tab('show');
                        $("#tab2_link").removeClass("disabled");
                        $("#tab2_link a").attr('data-toggle','tab');
                        });

                    $("#button_to_blood_tests").click(function(e){
                        
                        $('#tab3_link').removeClass('invisible');
                        $('#myTab li:eq(3) a').tab('show');
                        $("#tab3_link").removeClass("disabled");
                        $("#tab3_link a").attr('data-toggle','tab');
                        });

                    $("#button_to_optional_info").click(function(e){
                        $('#tab4_link').removeClass('invisible');
                        $('#myTab li:eq(4) a').tab('show');
                        $("#tab4_link").removeClass("disabled");
                        $("#tab4_link a").attr('data-toggle','tab');
                        });

                    $("#button_submit").click(function(e){
                        $('#tabRisk_link').removeClass('invisible');
                        $('#myTab li:eq(5) a').tab('show');
                        $("#tabRisk_link").removeClass("disabled");
                        $("#tabRisk_link a").attr('data-toggle','tab');
                        //var spinner = new Spinner().spin($('#tabRisk'))
                        submitStuff();
                        });

                    $('#riskProgress').hide()
                        .ajaxStart(function(){
                                $(this).show();
                                })
                    .ajaxStop(function(){
                            $(this).hide();
                            });

                    $("#button_to_surescripts").click(function(e){
                        $('#tabTesting_link').removeClass('invisible');
                        $('#myTab li:eq(6) a').tab('show');
                        $("#tabTesting_link").removeClass("disabled");
                        $("#tabTesting_link a").attr('data-toggle','tab');
                        });

                    $("#button_to_html5_geolocate").click(function(e){
                        get_device_location();//maybe add a separate button to call this
                        });

                    $("#button_to_manually_geolocate").click(function(e){
                            geocode($('#inputMyAddress').val());
                        });


                    $("#hba1c_group").hide();
                    $("#diabetes_true").click(function(){ $("#hba1c_group").show(); });
                    $("#diabetes_false").click(function(){ $("#hba1c_group").hide(); });

                    //keep the non-active tabs from being clickable at first, since we haven't entered the data yet
                    $("#tab1_link a").click(function(e){ e.preventDefault() });
                    $("#tab2_link a").click(function(e){ e.preventDefault() });
                    $("#tab3_link a").click(function(e){ e.preventDefault() });
                    $("#tab4_link a").click(function(e){ e.preventDefault() });
                    $("#tabRisk_link a").click(function(e){ e.preventDefault() });
                    $("#tabTesting_link a").click(function(e){ e.preventDefault() });
                    $("#systolicLabel").click(function(e){ e.preventDefault() });
                    $("#diastolicLabel").click(function(e){ e.preventDefault() });
                    //$("#popover").popover();

                    });
                </script>
                <script>
                            fbuser={{fbuser}}

                            if(fbuser!=0){
                                window.fbAsyncInit = function() {
                                    FB.init({
                                        appId      : '151556668236323', // App ID
                                        channelUrl : '//www.measrme.com/channel.html', // Channel File
                                        status     : true, // check login status
                                        cookie     : true, // enable cookies to allow the server to access the session
                                        xfbml      : true  // parse XFBML
                                    });
                                    //first argument is the user id of the user you want to display
                                    FB.api('/{{fbuser}}', function(user) {
                                        console.log(user)
                                        if (user) {
                                            var image = document.getElementById('image');
                                            image.src = 'https://graph.facebook.com/' + user.id + '/picture';
                                            var name = document.getElementById('name');
                                            name.innerHTML = user.name
                                        }
                                    });

                                };
                                // Load the SDK Asynchronously
                                (function(d){
                                    var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
                                    if (d.getElementById(id)) {return;}
                                    js = d.createElement('script'); js.id = id; js.async = true;
                                    js.src = "//connect.facebook.net/en_US/all.js";
                                    ref.parentNode.insertBefore(js, ref);
                                }(document));
                                }else{
                                $('#fb_referral_div').hide();
                            }
                        </script>

                <script src="static/js/surescripts.js" type="text/javascript"></script>
                <script src="static/js/nav_logic.js" type="text/javascript"></script>
            </body>
        </html>
